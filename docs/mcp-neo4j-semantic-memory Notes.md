# mcp-neo4j-semantic-memory Notes

# Creating a base (semantic) ontology

The point of creating Base Semantic Ontologies is to allow natural language semantics to more easily associate with existing objects in memory and to have a semantic relationship between those memories.

- This request requires a "subject" parameter such as... 
  - "Scientific Papers"
  - "Rust Programming"
  - "Node Project"
  - "Python Project"
  - "New Idea"
  - "Projects"
  - "Timelines"
  - "Tools"
  - "Email"
  - etc...
- The base ontology is requested, and generated by the calling LLM via the MCP callback.
  - The request will be something like...<br>
    "Create a Base Semantic Ontology for `<Subject>` including semantic entities an potential relationships between those entities. generate a JSON response listing the entities, and potential entity-relationship-entity pairs."
  - We should also check first, if an existing base ontology, that fits the `<subject>` already exists and report back, as we don't want to over pollute the graph with base ontologies.
  - The base ontology entity and its entity subset is persisted to the graph as nodes where the base ontologies entities (child nodes) point to the base ontology (parent node) via "isA" relationships.
  - The within base ontology node we persist the the JSON struct of it's sub-entities and the various potential (entity-relationship-entity) ERE's that are possible.
  - We also check to see of the new Base Ontology is either a parent or a child of an existing Base Ontology, and we request that appropriate associations are made. This allows one to create a hierarchy of Base Semantic Ontologies.
- This can be done via one call-back to the LLM to generate appropriate cypher queries.
- Base ontologies can be created on the fly for objects as they come in, if one does not already exist.

## AI Coder

---

Create the create_base_ontology mcp tool that accepts a parameters: `<subject>`, `<force_it>`<br> 
- `<subject>`<br>
  - LLM callback: Check if the subject is already represented by an existing Base Ontology.<br>
    - Perform a query for the list of existing Base Ontologies.<br>
        - Check if <subject> is already represented by an existing Base Ontology.<br>
          - Already Represented: And` <force_it>` is not set.<br>
            - Return a message that the <<subject>> is already represented by the given Base Ontology.<br>
        - Not Represented: Or, `<force_it>` is set,<br>
          - Ensure that the new Base Ontology does not exist.<br>
            - Does not exist: Create the new Base Ontology and related Entities.<br>
              - This is done also don via an LLM call-back.
              - Return message that a new Base Ontology was created along with details.
          - Base Ontology exists.
            - Return appropriate message.

   

---

# Safe Cypher Queries

The safe Cypher Queries tool is used by the LLM call-back to execute safe Cypher queries on behalf of the MCP server. A user can use it to perform non-write operations, but write operations may only be performed on behalf of this MCP server.

We know that the MCP server is requesting the write operation by using a CASE expression to verify that a security node exists before the write operation is executed.

- Flow...
  - Request: Create a new Base Ontology
    - Create single Security node with a unique name
    - LLM Callback - Create Ontology structure (pass-in security node)
      - Cypher uses CASE: only if security node exists...
        - Write new Base Ontology structures
      - Return from call-back: (Ontology Structure) Success
    - Remove Security Node.
    - Return new Ontology Structure to calling LLM.

- Allow user to make read-only queries of mcp-memory.
  - The user may request the LLM to query memory in various ways but won't be able to write to the memory database, at least not with this MCP service.
  - If a cypher query comes into the safe_cypher_query function without a security_node parameter, it will return an error message write operators exist in the query.
    - Cypher Write Operators: CREATE, SET, DELETE, REMOVE
  - Add an environment variable to by-pass safe_cypher_queries? 
    - NEO4J_UNSAFE_MEMORY_CYPHERS=true 

## AI Coder...

---

  "Create a new mcp tool called safe_cypher_query that takes a security-node-name and a cypher-query. If cypher query contains any write operations (CREATE, SET, DELETE, REMOVE) it must be accompanied with a security-node-name, other wise, we go ahead and execute the read-only cypher. If the cypher contains write operations and a security-node-name, we enclude the cypher with a case statement which only executes the write-cypher if the named security-node exists."
  
---
